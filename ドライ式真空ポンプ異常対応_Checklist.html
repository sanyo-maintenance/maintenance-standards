<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>「ドライ式真空ポンプ」異常対応チェックリスト</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        @media print {
            body > .container, .mt-3.container { display: none; }
            #print-area { display: block !important; padding: 20px; }
            .print-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
            .print-table th, .print-table td { border: 1px solid #ccc; padding: 8px; text-align: left; }
            .print-table th { background-color: #f2f2f2; }
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">「ドライ式真空ポンプ」異常対応チェックリスト</h1>
        <div id="checklist-container"></div>
    </div>
    <div class="mt-3 container">
        <button id="prev-btn" class="btn btn-secondary">戻る</button>
        <button id="next-btn" class="btn btn-primary">次へ</button>
        <button id="exit-btn" class="btn btn-danger">終了</button>
        <button id="print-btn" class="btn btn-info" style="display: none;">印刷</button>
    </div>
    <div id="print-area" style="display: none;"></div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js @1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        const checklistData = [
    { "phase": 1, "phase_title": "１．異常検知・緊急停止", "type": "checklist_with_status", "category": "異常検知", "item": "ポンプが起動しない、またはモーターが回転しない", "item_id": "1_0", "linked_item_id": null },
    { "phase": 1, "phase_title": "１．異常検知・緊急停止", "type": "checklist_with_status", "category": "異常検知", "item": "到達真空度が規定値まで下がらない、または真空引きに時間がかかりすぎる", "item_id": "1_1", "linked_item_id": null },
    { "phase": 1, "phase_title": "１．異常検知・緊急停止", "type": "checklist_with_status", "category": "異常検知", "item": "運転中に「ガリガリ」「ゴロゴロ」といった異音、または金属接触音がある", "item_id": "1_2", "linked_item_id": null },
    { "phase": 1, "phase_title": "１．異常検知・緊急停止", "type": "checklist_with_status", "category": "異常検知", "item": "ポンプ本体や架台に異常な振動がある", "item_id": "1_3", "linked_item_id": null },
    { "phase": 1, "phase_title": "１．異常検知・緊急停止", "type": "checklist_with_status", "category": "異常検知", "item": "ポンプ本体の表面温度が異常に高い", "item_id": "1_4", "linked_item_id": null },
    { "phase": 1, "phase_title": "１．異常検知・緊急停止", "type": "checklist_with_status", "category": "異常検知", "item": "モーターの過負荷保護装置（サーマルリレー）が作動し、頻繁に停止する", "item_id": "1_5", "linked_item_id": null },
    { "phase": 1, "phase_title": "１．異常検知・緊急停止", "type": "checklist_with_status", "category": "異常検知", "item": "軸封部や排気口からプロセスガスや内部の粉体が漏れている", "item_id": "1_6", "linked_item_id": null },
    { "phase": 1, "phase_title": "１．異常検知・緊急停止", "type": "text_input", "category": "異常検知", "item": "その他", "item_id": "1_7", "linked_item_id": null },
    { "phase": 1, "phase_title": "１．異常検知・緊急停止", "type": "checklist", "category": "緊急停止措置", "item": "ポンプの緊急停止ボタンを操作する。", "item_id": "1_8", "linked_item_id": null },
    { "phase": 1, "phase_title": "１．異常検知・緊急停止", "type": "checklist", "category": "緊急停止措置", "item": "制御盤の主電源を遮断し、施錠（ロックアウト）および表示（タグアウト）を実施する。", "item_id": "1_9", "linked_item_id": null },
    { "phase": 1, "phase_title": "１．異常検知・緊急停止", "type": "checklist", "category": "緊急停止措置", "item": "ポンプの吸気側バルブおよび排気側バルブを閉鎖する。", "item_id": "1_10", "linked_item_id": null },
    { "phase": 1, "phase_title": "１．異常検知・緊急停止", "type": "checklist", "category": "緊急停止措置", "item": "（危険・有毒ガスの場合）定められた安全手順に従い、ガス供給を遮断し、必要に応じて除害装置を作動させる。", "item_id": "1_11", "linked_item_id": null },
    { "phase": 2, "phase_title": "２．故障原因調査", "type": "checklist_with_status", "category": "【使用部門】ユーティリティ確認", "item": "冷却水の流量不足、温度異常、または供給停止", "item_id": "2_0", "linked_item_id": null },
    { "phase": 2, "phase_title": "２．故障原因調査", "type": "checklist_with_status", "category": "【使用部門】ユーティリティ確認", "item": "パージガス（窒素ガス等）の圧力不足、または供給停止", "item_id": "2_1", "linked_item_id": null },
    { "phase": 2, "phase_title": "２．故障原因調査", "type": "checklist_with_status", "category": "【使用部門】プロセス確認", "item": "プロセスチャンバー側で大きなリークが発生している", "item_id": "2_2", "linked_item_id": null },
    { "phase": 2, "phase_title": "２．故障原因調査", "type": "checklist_with_status", "category": "【使用部門】プロセス確認", "item": "想定外の反応生成物（固形物、付着物）がポンプ内に流入している", "item_id": "2_3", "linked_item_id": null },
    { "phase": 2, "phase_title": "２．故障原因調査", "type": "checklist_with_status", "category": "【使用部門】プロセス確認", "item": "大気圧からの真空引きを短時間で繰り返している（モーターへの過負荷）", "item_id": "2_4", "linked_item_id": null },
    { "phase": 2, "phase_title": "２．故障原因調査", "type": "checklist_with_status", "category": "【使用部門】外観・目視点検", "item": "吸気側配管のバルブが全開になっていない", "item_id": "2_5", "linked_item_id": null },
    { "phase": 2, "phase_title": "２．故障原因調査", "type": "checklist_with_status", "category": "【使用部門】外観・目視点検", "item": "排気側配管が詰まっている、または背圧が高すぎる", "item_id": "2_6", "linked_item_id": null },
    { "phase": 2, "phase_title": "２．故障原因調査", "type": "checklist_with_status", "category": "【メンテナンス部門】制御・電気系統", "item": "モーターへの供給電圧が不均一または低下している（欠相を含む）", "item_id": "2_7", "linked_item_id": null },
    { "phase": 2, "phase_title": "２．故障原因調査", "type": "checklist_with_status", "category": "【メンテナンス部門】制御・電気系統", "item": "モーターの過負荷保護装置（サーマルリレー）の設定値が不適切", "item_id": "2_8", "linked_item_id": null },
    { "phase": 2, "phase_title": "２．故障原因調査", "type": "checklist_with_status", "category": "【メンテナンス部門】制御・電気系統", "item": "インバーターにエラーが表示されている、またはパラメータ設定が不適切", "item_id": "2_9", "linked_item_id": null },
    { "phase": 2, "phase_title": "２．故障原因調査", "type": "checklist_with_status", "category": "【メンテナンス部門】ポンプ本体・内部部品（分解点検）", "item": "ローター同士、またはローターとケーシングが接触した痕跡がある", "item_id": "2_10", "linked_item_id": null },
    { "phase": 2, "phase_title": "２．故障原因調査", "type": "checklist_with_status", "category": "【メンテナンス部門】ポンプ本体・内部部品（分解点検）", "item": "タイミングギヤに摩耗やバックラッシの増大がある", "item_id": "2_11", "linked_item_id": null },
    { "phase": 2, "phase_title": "２．故障原因調査", "type": "checklist_with_status", "category": "【メンテナンス部門】ポンプ本体・内部部品（分解点検）", "item": "軸受（ベアリング）に摩耗、焼き付き、破損がある", "item_id": "2_12", "linked_item_id": null },
    { "phase": 2, "phase_title": "２．故障原因調査", "type": "checklist_with_status", "category": "【メンテナンス部門】ポンプ本体・内部部品（分解点検）", "item": "軸封（シャフトシール）に摩耗、硬化、損傷がある", "item_id": "2_13", "linked_item_id": null },
    { "phase": 2, "phase_title": "２．故障原因調査", "type": "checklist_with_status", "category": "【メンテナンス部門】ポンプ本体・内部部品", "item": "ポンプ内部にプロセス生成物が大量に堆積・固着している", "item_id": "2_14", "linked_item_id": null },
    { "phase": 2, "phase_title": "２．故障原因調査", "type": "checklist_with_status", "category": "【メンテナンス部門】付属機器", "item": "吸気側のインレットフィルター（トラップ）に詰まりがある", "item_id": "2_15", "linked_item_id": null },
    { "phase": 3, "phase_title": "３．対策実施", "type": "checklist", "category": "【使用部門】ユーティリティ確認", "item": "冷却水の流量・温度を規定値に調整する。供給を復旧させる。", "item_id": "3_0", "linked_item_id": "2_0" },
    { "phase": 3, "phase_title": "３．対策実施", "type": "checklist", "category": "【使用部門】ユーティリティ確認", "item": "パージガスの圧力を規定値に調整する。供給を復旧させる。", "item_id": "3_1", "linked_item_id": "2_1" },
    { "phase": 3, "phase_title": "３．対策実施", "type": "checklist", "category": "【使用部門】プロセス確認", "item": "チャンバー側のリーク箇所を特定し、修理する。", "item_id": "3_2", "linked_item_id": "2_2" },
    { "phase": 3, "phase_title": "３．対策実施", "type": "checklist", "category": "【使用部門】プロセス確認", "item": "プロセスの運転条件を見直し、異常生成物の流入を防止する。", "item_id": "3_3", "linked_item_id": "2_3" },
    { "phase": 3, "phase_title": "３．対策実施", "type": "checklist", "category": "【使用部門】プロセス確認", "item": "ポンプの運転シーケンスを見直し、モーターへの負荷を軽減する。", "item_id": "3_4", "linked_item_id": "2_4" },
    { "phase": 3, "phase_title": "３．対策実施", "type": "checklist", "category": "【使用部門】外観・目視点検", "item": "吸気側配管のバルブを完全に開ける。", "item_id": "3_5", "linked_item_id": "2_5" },
    { "phase": 3, "phase_title": "３．対策実施", "type": "checklist", "category": "【使用部門】外観・目視点検", "item": "排気側配管の詰まりを除去する。", "item_id": "3_6", "linked_item_id": "2_6" },
    { "phase": 3, "phase_title": "３．対策実施", "type": "checklist", "category": "【メンテナンス部門】制御・電気系統", "item": "電源系統を点検し、電圧が不安定な原因を特定・修理する。", "item_id": "3_7", "linked_item_id": "2_7" },
    { "phase": 3, "phase_title": "３．対策実施", "type": "checklist", "category": "【メンテナンス部門】制御・電気系統", "item": "モーターの定格電流値に合わせて、過負荷保護装置の設定値を再設定する。", "item_id": "3_8", "linked_item_id": "2_8" },
    { "phase": 3, "phase_title": "３．対策実施", "type": "checklist", "category": "【メンテナンス部門】制御・電気系統", "item": "インバーターのエラー内容に応じて修理・交換、またはパラメータを再設定する。", "item_id": "3_9", "linked_item_id": "2_9" },
    { "phase": 3, "phase_title": "３．対策実施", "type": "checklist", "category": "【メンテナンス部門】ポンプ本体・内部部品", "item": "ポンプをオーバーホールし、接触したローターやケーシングを修正・交換する。", "item_id": "3_10", "linked_item_id": "2_10" },
    { "phase": 3, "phase_title": "３．対策実施", "type": "checklist", "category": "【メンテナンス部門】ポンプ本体・内部部品", "item": "タイミングギヤのバックラッシを調整するか、摩耗したギヤを交換する。", "item_id": "3_11", "linked_item_id": "2_11" },
    { "phase": 3, "phase_title": "３．対策実施", "type": "checklist", "category": "【メンテナンス部門】ポンプ本体・内部部品", "item": "損傷した軸受（ベアリング）を交換する。", "item_id": "3_12", "linked_item_id": "2_12" },
    { "phase": 3, "phase_title": "３．対策実施", "type": "checklist", "category": "【メンテナンス部門】ポンプ本体・内部部品", "item": "劣化した軸封（シャフトシール）を新品に交換する。", "item_id": "3_13", "linked_item_id": "2_13" },
    { "phase": 3, "phase_title": "３．対策実施", "type": "checklist", "category": "【メンテナンス部門】ポンプ本体・内部部品", "item": "ポンプを分解し、内部に堆積した生成物を安全な方法で除去・清掃する。", "item_id": "3_14", "linked_item_id": "2_14" },
    { "phase": 3, "phase_title": "３．対策実施", "type": "checklist", "category": "【メンテナンス部門】付属機器", "item": "インレットフィルターのエレメントを清掃または交換する。", "item_id": "3_15", "linked_item_id": "2_15" },
    { "phase": 4, "phase_title": "４．再起動前準備", "type": "checklist", "category": "復旧確認", "item": "交換した部品や修理箇所が、メーカーの仕様通りに正しく組付けられていることを確認する。", "item_id": "4_0", "linked_item_id": null },
    { "phase": 4, "phase_title": "４．再起動前準備", "type": "checklist", "category": "復旧確認", "item": "ポンプ内部や配管に工具、部品、ウエスなどが放置されていないことを確認する。", "item_id": "4_1", "linked_item_id": null },
    { "phase": 4, "phase_title": "４．再起動前準備", "type": "checklist", "category": "安全確認", "item": "全ての安全カバーが所定の位置に確実に取り付けられていることを確認する。", "item_id": "4_2", "linked_item_id": null },
    { "phase": 4, "phase_title": "４．再起動前準備", "type": "checklist", "category": "ユーティリティ確認", "item": "冷却水、パージガス、電源が全て正常に供給できる状態であることを確認する。", "item_id": "4_3", "linked_item_id": null },
    { "phase": 4, "phase_title": "４．再起動前準備", "type": "checklist", "category": "電源投入", "item": "関係者全員の安全を確認後、ロックアウト/タグアウトを正規の手順で解除する。", "item_id": "4_4", "linked_item_id": null },
    { "phase": 4, "phase_title": "４．再起動前準備", "type": "checklist", "category": "電源投入", "item": "制御盤の主電源を投入し、エラー表示などが出ていないことを確認する。", "item_id": "4_5", "linked_item_id": null },
    { "phase": 4, "phase_title": "４．再起動前準備", "type": "checklist", "category": "状態記録", "item": "故障内容、原因、対策、交換部品などを設備台帳や作業報告書に正確に記録する。", "item_id": "4_6", "linked_item_id": null },
    { "phase": 5, "phase_title": "５．試運転・正規運転", "type": "checklist", "category": "寸動運転", "item": "モーターを瞬間的に回転させ、回転方向が正しいこと、および内部での接触音がないことを確認する。", "item_id": "5_0", "linked_item_id": null },
    { "phase": 5, "phase_title": "５．試運転・正規運転", "type": "checklist", "category": "無負荷運転", "item": "吸気側バルブを閉じた状態でポンプを起動し、5〜10分程度空運転する。", "item_id": "5_1", "linked_item_id": null },
                { "phase": 5, "phase_title": "５．試運転・正規運転", "type": "checklist", "category": "性能指標確認", "item": "無負荷運転中に、異音、異常振動、本体の異常な温度上昇がないことを確認する。", "item_id": "5_2", "linked_item_id": null },,
                { "phase": 5, "phase_title": "５．試運転・正規運転", "type": "checklist", "category": "性能指標確認", "item": "無負荷運転状態で、到達真空度が規定値に達することを測定・確認する。", "item_id": "5_3", "linked_item_id": null },,
    { "phase": 5, "phase_title": "５．試運転・正規運転", "type": "checklist", "category": "軽負荷運転", "item": "吸気側バルブをゆっくりと開け、プロセスガスを導入し、ポンプの状態を監視する。", "item_id": "5_4", "linked_item_id": null },
                { "phase": 5, "phase_title": "５．試運転・正規運転", "type": "checklist", "category": "性能指標確認", "item": "正規の運転状態で、モーターの電流値が定格内で安定していることを測定・確認する。", "item_id": "5_5", "linked_item_id": null },,
                { "phase": 5, "phase_title": "５．試運転・正規運転", "type": "checklist", "category": "性能指標確認", "item": "正規の運転状態で、真空度、排気速度がプロセスの要求仕様を満たしていることを確認する。", "item_id": "5_6", "linked_item_id": null },,
    { "phase": 5, "phase_title": "５．試運転・正規運転", "type": "checklist", "category": "正規運転・監視", "item": "運転開始後の一定時間（例：1時間）は重点的に監視し、温度、振動、騒音、電流値に異常の再発がないことを確認する。", "item_id": "5_7", "linked_item_id": null }
];
        const PRINT_TRIGGER_PHASE = 3;
        let currentPhase = 1;
        const maxPhase = Math.max(...checklistData.map(item => item.phase));
        let checklistState = {};

        function saveState() { sessionStorage.setItem('checklistState', JSON.stringify(checklistState)); sessionStorage.setItem('currentPhase', currentPhase); }
        function loadState() { const savedState = sessionStorage.getItem('checklistState'); const savedPhase = sessionStorage.getItem('currentPhase'); if (savedState) checklistState = JSON.parse(savedState); if (savedPhase) currentPhase = parseInt(savedPhase, 10); }

        function renderCurrentPhase() {
            const container = $('#checklist-container'); container.empty();
            let itemsToShow = checklistData.filter(item => item.phase === currentPhase);
            const phaseTitle = itemsToShow.length > 0 ? itemsToShow[0].phase_title : `Phase ${currentPhase}`;
            if (currentPhase === 3 || currentPhase === 5) { itemsToShow = itemsToShow.filter(item => checklistState[item.linked_item_id] === 'problem'); }
            container.append(`<h2 class="phase-title">${phaseTitle}</h2>`);
            if (itemsToShow.length === 0 && (currentPhase === 3 || currentPhase === 5)) { container.append('<p>このフェーズで表示する項目はありません。前のフェーズで「問題あり」と選択された項目がありませんでした。</p>');
            } else { const groupedItems = itemsToShow.reduce((acc, item) => { (acc[item.category] = acc[item.category] || []).push(item); return acc; }, {}); for (const category in groupedItems) { container.append(`<h3 class="category-title">${category}</h3>`); groupedItems[category].forEach(item => container.append(createItemHtml(item))); } }
            updateButtonVisibility(); restoreState();
        }

        function createItemHtml(item) {
            const { type, item_id, item: itemText, phase } = item; let interactiveElementHtml = ''; const buttonStyle = 'style="min-width: 95px;"';
            if (type === 'checklist') { interactiveElementHtml = `<div class="btn-group-toggle" data-toggle="buttons"><label class="btn btn-outline-primary" ${buttonStyle} data-item-id="${item_id}" data-value="checked"><input type="checkbox" autocomplete="off"> 実施済み</label></div>`;
            } else if (type === 'checklist_with_status') { if (phase === 1) { interactiveElementHtml = `<div class="btn-group btn-group-toggle" data-toggle="buttons"><label class="btn btn-outline-success" ${buttonStyle} data-item-id="${item_id}" data-value="applicable"><input type="radio" name="options-${item_id}" autocomplete="off"> 該当</label><label class="btn btn-outline-danger" ${buttonStyle} data-item-id="${item_id}" data-value="not_applicable"><input type="radio" name="options-${item_id}" autocomplete="off"> 非該当</label></div>`; } else { interactiveElementHtml = `<div class="btn-group btn-group-toggle" data-toggle="buttons"><label class="btn btn-outline-success" ${buttonStyle} data-item-id="${item_id}" data-value="ok"><input type="radio" name="options-${item_id}" autocomplete="off"> 問題なし</label><label class="btn btn-outline-danger" ${buttonStyle} data-item-id="${item_id}" data-value="problem"><input type="radio" name="options-${item_id}" autocomplete="off"> 問題あり</label></div>`; } 
            } else if (type === 'checklist_with_na') { interactiveElementHtml = `<div class="btn-group btn-group-toggle" data-toggle="buttons"><label class="btn btn-outline-primary" ${buttonStyle} data-item-id="${item_id}" data-value="checked"><input type="radio" name="options-${item_id}" autocomplete="off"> 実施済み</label><label class="btn btn-outline-secondary" ${buttonStyle} data-item-id="${item_id}" data-value="not_applicable"><input type="radio" name="options-${item_id}" autocomplete="off"> 非該当</label></div>`;
            } else if (type === 'text_input') { const labelHtml = `<label class="col-auto col-form-label pr-3">${itemText}</label>`; const textareaHtml = `<div class="col pl-0"><textarea class="form-control" rows="2" data-item-id="${item_id}" placeholder="具体的な内容を入力"></textarea></div>`; return `<div class="form-group row no-gutters align-items-center">${labelHtml}${textareaHtml}</div>`; }
            return `<div class="checklist-item-row"><label class="form-check-label item-label">${itemText}</label>${interactiveElementHtml}</div>`;
        }
        
        function restoreState() { for (const itemId in checklistState) { const value = checklistState[itemId]; $(`label[data-item-id="${itemId}"][data-value="${value}"]`).addClass('active').find('input').prop('checked', true); $(`textarea[data-item-id="${itemId}"]`).val(value); } validateCurrentPhaseCompletion(); updatePrintButtonVisibility(); }
        function validateCurrentPhaseCompletion() { const requiredItems = checklistData.filter(item => { if (item.phase !== currentPhase || item.type === 'text_input') return false; return $(`[data-item-id="${item.item_id}"]`).length > 0; }); if (requiredItems.length === 0) { if (currentPhase < maxPhase) $('#next-btn').prop('disabled', false); return; } const allChecked = requiredItems.every(item => checklistState.hasOwnProperty(item.item_id)); $('#next-btn').prop('disabled', !allChecked); }
        function updatePrintButtonVisibility() { const requiredItems = checklistData.filter(item => { if (item.phase !== PRINT_TRIGGER_PHASE) return false; if (item.linked_item_id) { return checklistState[item.linked_item_id] === 'problem'; } return true; }); const allChecked = requiredItems.every(item => checklistState.hasOwnProperty(item.item_id)); if (requiredItems.length > 0 && allChecked) { $('#print-btn').show(); } else { $('#print-btn').hide(); } }
        function updateButtonVisibility() { $('#prev-btn').toggle(currentPhase > 1); $('#next-btn').toggle(currentPhase < maxPhase); $('#next-btn').prop('disabled', true); }

        $(document).ready(function() {
            loadState(); renderCurrentPhase();
            $('#next-btn, #prev-btn').on('click', function() { if ($(this).is('#next-btn') && $(this).is(':disabled')) return; currentPhase += $(this).is('#next-btn') ? 1 : -1; saveState(); renderCurrentPhase(); });
            $('#exit-btn').on('click', () => { if (confirm('チェックリストを終了し、メインメニューに戻りますか？')) { sessionStorage.clear(); window.location.href = 'index.html'; } });
            $('#print-btn').on('click', function() {
                const printContainer = $('#print-area');
                let html = `<h1>「${document.title.replace('異常対応チェックリスト', '')}」実施結果</h1>`;
                const valueMap = { 'checked': '実施済み', 'applicable': '該当', 'not_applicable': '非該当', 'ok': '問題なし', 'problem': '問題あり' };
                const answeredPhaseNumbers = [...new Set(Object.keys(checklistState).map(itemId => checklistData.find(d => d.item_id === itemId)?.phase).filter(p => p).sort((a, b) => a - b))];

                answeredPhaseNumbers.forEach(phaseNum => {
                    const phaseItems = checklistData.filter(d => d.phase === phaseNum && checklistState.hasOwnProperty(d.item_id));
                    if (phaseItems.length > 0) {
                        const printableItems = phaseItems.filter(item => {
                            if (item.linked_item_id) { return checklistState[item.linked_item_id] === 'problem'; }
                            return true;
                        });
                        if (printableItems.length > 0) {
                            html += `<h2>${printableItems[0].phase_title}</h2><table class="print-table"><tr><th>項目</th><th>結果</th></tr>`;
                            printableItems.forEach(item => {
                                let result = checklistState[item.item_id];
                                let resultText = valueMap[result] || result;
                                let style = (result === 'problem') ? 'style="color: red;"' : '';
                                html += `<tr><td>${item.item}</td><td ${style}>${resultText}</td></tr>`;
                            });
                            html += '</table>';
                        }
                    }
                });
                printContainer.html(html);
                window.print();
            });
            $('#checklist-container').on('click', 'label.btn', function() { const label = $(this), itemId = label.data('item-id'); setTimeout(() => { if (label.find('input').is('[type=radio]')) { const activeValue = label.closest('.btn-group-toggle').find('.active').data('value'); if(activeValue) checklistState[itemId] = activeValue; else delete checklistState[itemId]; } else { if (label.hasClass('active')) checklistState[itemId] = label.data('value'); else delete checklistState[itemId]; } saveState(); validateCurrentPhaseCompletion(); updatePrintButtonVisibility(); }, 0); });
            $('#checklist-container').on('input', 'textarea', function() { const input = $(this), itemId = input.data('item-id'), value = input.val(); if (value) checklistState[itemId] = value; else delete checklistState[itemId]; saveState(); });
        });
    </script>
</body>
</html>
